<!DOCTYPE html>
<html>
<head>
<title>Wallet</title>
<style>
body { background: lightgreen; font-family: Arial; }
.box { padding: 10px; margin: 10px; }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
.btn { background: navy; color:white; padding:15px; text-align:center; cursor:pointer; }
.heart { font-size:60px; cursor:pointer; }
</style>
</head>

<body>
<div class="box">
  <b>WINNINGS:</b> R<span id="winnings">0</span>
  <div id="claims"></div>
</div>

<div class="box">
  <b>BALANCE:</b> R<span id="balance">0</span>
</div>

<div class="grid">
  <div class="btn" onclick="pay(5)">R5</div>
  <div class="btn" onclick="pay(10)">R10</div>
  <div class="btn" onclick="pay(15)">R15</div>
  <div class="btn" onclick="pay(20)">R20</div>
</div>

<div class="box">
  <b>LIVES:</b> <span id="lives">0</span> ♥
  <div class="heart" onclick="buyLife()">♥</div>
</div>

<script type="module">
import { auth, db } from "../firebase.js";
import { ref, onValue, update } from
"https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

let uid, balance = 0, lives = 0;

auth.onAuthStateChanged(user => {
  if (!user) location.href="../index.html";
  uid = user.uid;

  onValue(ref(db, "users/"+uid+"/wallet"), snap => {
    const w = snap.val() || {};
    balance = w.balance || 0;
    lives = w.lives || 0;
    balanceSpan.textContent = balance.toFixed(2);
    livesSpan.textContent = lives;
    renderWinnings(w.winnings || {});
  });
});

window.buyLife = async () => {
  if (lives >= 5) return alert("Max lives reached");
  if (balance < 0.5) return alert("Insufficient balance");

  await update(ref(db,"users/"+uid+"/wallet"), {
    balance: balance - 0.5,
    lives: lives + 1
  });
};

window.pay = amount => {
  const links = {
    5: "https://payf.st/pviof",
    10: "https://payf.st/7d4zb",
    15: "https://payf.st/7yw30",
    20: "https://payf.st/2564l"
  };
  window.location.href = links[amount];
};

function renderWinnings(wins){
  claims.innerHTML="";
  let total=0;
  Object.entries(wins).forEach(([id,w])=>{
    total+=w.amount;
    const div=document.createElement("div");
    div.innerHTML = w.claimed
      ? `R${w.amount} (CLAIMED)`
      : `R${w.amount} <button onclick="claim('${id}')">CLAIM</button>`;
    claims.appendChild(div);
  });
  winnings.textContent = total.t
